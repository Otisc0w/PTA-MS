<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PTA | Profile</title>
  <link rel="icon" type="image/x-icon" href="../images/favicon.ico" />
  <link rel="stylesheet" type="text/css" href="../stylesheets/profile.css" />
  <link rel="stylesheet" type="text/css" href="../stylesheets/navbar.css" />
	<link rel="stylesheet" type="text/css" href="../stylesheets/faqs.css" />
  <link rel="stylesheet" type="text/css" href="../stylesheets/footer.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>
<body class="container">
  <div class="header">
    {{> navbar}}
  </div>

  <div class="profile-container">
    <div class="side-nav">
      <ul>
        <li><a href="profile?tab=viewProfile" id="viewProfileLink">View Profile</a></li>
        <li><a href="profile?tab=editProfile" id="editProfileLink">Edit Profile</a></li>
        <li><a href="profile?tab=helpCenter" id="helpcenter">Help Center</a></li>
      </ul>
    </div>
    <div class="profile-content">
      <div id="editProfile" class="profile-section">
        <h2>Edit Profile</h2>
        <form id="editprofile" action="/save-profile-changes" method="post" enctype="multipart/form-data">
          <div class="profile-pic-section">
            {{#if user.profilepic}}
            <img src="{{user.profilepic}}" alt="Profile Picture" class="profile-picture">
            {{else}}
            <img src="/images/none.jpg" alt="Profile Picture" class="profile-picture">
            {{/if}}
            <div>
              {{#if user.ptaverified}}
                <span class="tag">ADMIN</span>
              {{else}}
                {{#if user.instructorverified}}
                  <span class="tag">INSTRUCTOR</span>
                {{/if}}
                {{#if user.athleteverified}}
                  <span class="tag">ATHLETE</span>
                {{/if}}
              {{/if}}
            </div>
            <input type="file" id="file-input" name="file" class="edit-profile-pic">
          </div>
          <div class="form-group">
            <label for="firstname">First Name:</label>
            <input type="text" id="firstname" name="firstname" value="{{user.firstname}}" readonly class="readonly-field">
            <span class="lock-icon"><i class="fas fa-lock"></i></span>
          </div>
          <div class="form-group">
            <label for="middlename">M.I.:</label>
            <input type="text" id="middlename" name="middlename" value="{{user.middlename}}" readonly class="readonly-field">
            <span class="lock-icon"><i class="fas fa-lock"></i></span>
          </div>
          <div class="form-group">
            <label for="lastname">Last Name:</label>
            <input type="text" id="lastname" name="lastname" value="{{user.lastname}}" readonly class="readonly-field">
            <span class="lock-icon"><i class="fas fa-lock"></i></span>
          </div>
          <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" value="{{user.username}}" readonly class="readonly-field">
            <span class="lock-icon"><i class="fas fa-lock"></i></span>
          </div>
          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="{{user.email}}" class="editable-field">
          </div>
          <div class="form-group">
            <input type="hidden" id="athleteverified" name="athleteverified" value="{{user.athleteverified}}" readonly>
            <input type="hidden" id="instructorverified" name="instructorverified" value="{{user.instructorverified}}" readonly>
            <input type="hidden" id="ptaverified" name="ptaverified" value="{{user.ptaverified}}" readonly>
          </div>
          <div class="form-actions">
            <button class="cancel-button" onclick="window.location.href='profile'">Cancel</button>
            <button class="save-button" type="submit">Save Changes</button>
          </div>
        </form>
      </div>

      <div id="viewProfile" class="profile-section" style="display:none;">
        <h2>View Profile</h2>
        <div class="profile-pic-section">
          {{#if user.profilepic}}
          <img src="{{user.profilepic}}" alt="Profile Picture" class="profile-picture">
          {{else}}
          <img src="/images/none.jpg" alt="Profile Picture" class="profile-picture">
          {{/if}}
          <div>
            {{#if user.ptaverified}}
              <span class="tag">ADMIN</span>
            {{else}}
              {{#if user.instructorverified}}
                <span class="tag">INSTRUCTOR</span>
              {{/if}}
              {{#if user.athleteverified}}
                <span class="tag">ATHLETE</span>
              {{/if}}
            {{/if}}
          </div>
        </div>
        <form>
          <div class="form-group">
            <label for="firstname">First Name:</label>
            <input type="text" id="firstname" name="firstname" value="{{user.firstname}}" readonly>
          </div>
          <div class="form-group">
            <label for="middlename">M.I.:</label>
            <input type="text" id="middlename" name="middlename" value="{{user.middlename}}" readonly>
          </div>
          <div class="form-group">
            <label for="lastname">Last Name:</label>
            <input type="text" id="lastname" name="lastname" value="{{user.lastname}}" readonly>
          </div>
          <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" value="{{user.username}}" readonly>
          </div>
          <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" value="{{user.email}}" readonly>
          </div>
        </form>
      </div>

      <div id="helpCenter" class="profile-section" style="display:none;">
        <h1>Questions?</h1>
        <p>If you have questions, we have answers for you here. In case we don't, you can check our Forum page or please feel free to reach out to us here pthtkd@gmail.com or 0977 384 5879.</p>

        <h2>General questions</h2>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>How can I apply for NCC ID?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Go to the "Membership" page on the PTA website and click "Apply for NCC ID." Fill out the required
                    information and upload the necessary documents before submitting your application.</p>
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>How do I check the status of my application?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>You can view your application status by visiting the "Registration Status" section on the Membership
                    page.</p>
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>How do I renew my membership?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Membership renewal can be done by submitting a new application through the Membership page. The PTA
                    admin team will review your application to confirm eligibility for renewal.</p>
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>How do I contact the PTA for inquiries?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>You can reach the Philippine Taekwondo Association through the following channels:<br>
                    Official website: https://philippinetaekwondo.org<br>
                    Email: philtkd@gmail.com<br>
                    Phone: 0977 384 5870<br>
                    Office address: Philippine Taekwondo Central Headquarters<br>
                    Rizal Memorial Coliseum, Manila, Philippines</p>
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>How do I join a club?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Visit the "Clubs" page on the PTA website to view a list of affiliated clubs. Each club provides detailed information about its location, instructor, training schedule, and other features. Choose the club that best fits your preferences and contact them directly for membership inquiries.</p>
          </div>
        </div>

        <div class="faq-item">
          <div class="faq-question" onclick="toggleFaq(this)">
            <span>Can I transfer from one club to another?</span>
            <span class="faq-toggle">+</span>
          </div>
          <div class="faq-answer">
            <p>Yes, but it requires coordination between your current club and the new club. Inform your current instructor and complete any necessary transfer forms.</p>
          </div> 
        </div>
      </div>
    </div>
  </div>

  {{> footer}}

  <!-- Scripts -->
  <script src="/scripts/navbar.js"></script>
  <script src="/scripts/footer.js"></script>
  <script>
    function toggleDropdown() {
      document.getElementById("dropdown").classList.toggle("show");
    }

    window.onclick = function(event) {
      if (!event.target.matches('.profile-pic img')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        for (var i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown.classList.remove('show');
          }
        }
      }
    }

    function setActiveTab() {
      const params = new URLSearchParams(window.location.search);
      const tab = params.get('tab') || 'viewProfile';
      document.querySelectorAll('.profile-section').forEach(section => {
        section.style.display = 'none';
      });
      document.getElementById(tab).style.display = 'block';
      document.querySelectorAll('.side-nav ul li a').forEach(link => {
        link.classList.remove('active');
      });
      document.getElementById(tab + 'Link').classList.add('active');
    }

    window.onload = setActiveTab;

    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    document.getElementById('editprofile').addEventListener('submit', async function(event) {
      event.preventDefault();
      
      const emailInput = document.getElementById('email');
      const oldEmail = '{{user.email}}';
      
      // Validate email
      if (!validateEmail(emailInput.value)) {
        alert('Please enter a valid email address');
        emailInput.focus();
        return false;
      }
      
      try {
        // Submit the form
        const formData = new FormData(this);
        const response = await fetch('/save-profile-changes', {
          method: 'POST',
          body: formData
        });
        
        if (response.ok) {
          alert('Profile updated successfully!');
          window.location.reload();
        } else {
          alert('Failed to update profile. Please try again.');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while updating the profile.');
      }
    });

    function toggleFaq(element) {
      const answer = element.nextElementSibling;
      const toggle = element.querySelector('.faq-toggle');
      
      if (answer.style.display === "block") {
        answer.style.display = "none";
        toggle.textContent = "+";
      } else {
        answer.style.display = "block";
        toggle.textContent = "x";
      }
    }
  </script>
  
  <script src="https://cdn.botpress.cloud/webchat/v1/inject.js"></script>
  <script src="https://mediafiles.botpress.cloud/28a4809e-d421-4549-b02c-8dd82392211b/webchat/config.js" defer></script>
</body>
</html>