<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PTA | Membership Review</title>
  <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
  <link rel="stylesheet" type="text/css" href="../stylesheets/instructor-review.css">
  <link rel="stylesheet" type="text/css" href="../stylesheets/navbar.css">
  <link rel="stylesheet" type="text/css" href="../stylesheets/footer.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body class="container">
  <div class="header">
    {{> navbar}}
  </div>

  <main class="membership-container">
    <section class="review-header">
      <h1>Review Instructor Application</h1>
    </section>

    <section class="review-details">
      <h2>Applicant Information</h2>

      <form action={{#if user.ptaverified}}"/update-instructorstatus"{{else}}"/submit-instructor" enctype="multipart/form-data"{{/if}} method="post">
        <input type="hidden" name="instructorregid" value="{{registration.id}}">
        <table class="details-section">
          <tr>
            <td colspan="2">
              <img class="athlete-picture" src="{{registration.portrait}}">
            </td>
            <td>
              <table>
                <tr>
                  <td><strong>First Name:</strong></td>
                  <td><input type="text" name="firstname" value="{{registration.firstname}}" {{#if (or user.ptaverified
                      registration.firstname)}}readonly{{else}}required{{/if}}>
                    {{#if user.ptaverified}}<button type="button" class="clear-input"
                      onclick="clearInput(this)">x</button>{{/if}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Middle Initial:</strong></td>
                  <td><input type="text" name="middlename" value="{{registration.middlename}}" {{#if (or
                      user.ptaverified registration.middlename)}}readonly{{else}}required{{/if}}>
                    {{#if user.ptaverified}}<button type="button" class="clear-input"
                      onclick="clearInput(this)">x</button>{{/if}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Last Name:</strong></td>
                  <td><input type="text" name="lastname" value="{{registration.lastname}}" {{#if (or user.ptaverified
                      registration.lastname)}}readonly{{else}}required{{/if}}>
                    {{#if user.ptaverified}}<button type="button" class="clear-input"
                      onclick="clearInput(this)">x</button>{{/if}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Gender:</strong></td>
                  <td><input type="text" name="gender" value="{{registration.gender}}" {{#if (or user.ptaverified
                      registration.gender)}}readonly{{else}}required{{/if}}>
                    {{#if user.ptaverified}}<button type="button" class="clear-input"
                      onclick="clearInput(this)">x</button>{{/if}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Birthday:</strong></td>
                  <td><input type="date" name="bday" value="{{registration.bday}}" {{#if (or user.ptaverified
                      registration.bday)}}readonly{{else}}required{{/if}}>
                    {{#if user.ptaverified}}<button type="button" class="clear-input"
                      onclick="clearInput(this)">x</button>{{/if}}
                  </td>
                </tr>
                <tr>
                  <td><strong>Phone Number:</strong></td>
                  <td><input type="tel" name="phonenum" value="{{registration.phonenum}}" {{#if user.ptaverified}}readonly{{else}}required{{/if}}>
                    <button type="button" class="clear-input"
                      onclick="clearInput(this)">x</button>
                  </td>
                </tr>
                <tr>
                  <td><strong>Email:</strong></td>
                  <td><input type="email" name="email" value="{{registration.email}}" {{#if user.ptaverified}}readonly{{else}}required{{/if}}>
                    <button type="button" class="clear-input"
                      onclick="clearInput(this)">x</button>
                  </td>
                </tr>
                <tr>
                  <td><strong>Club Region:</strong></td>
                  <td><input type="text" name="clubprovince" value="{{registration.clubprovince}}" {{#if (or
                      user.ptaverified registration.clubprovince)}}readonly{{else}}required{{/if}}>
                    {{#if user.ptaverified}}<button type="button" class="clear-input"
                      onclick="clearInput(this)">x</button>{{/if}}
                  </td>
                </tr>
                <tr>
                  <td colspan="2"><strong>Birth Certificate:</strong></td>
                  <td class="information">
                    {{#if registration.birthcert}}
                      <a href="{{registration.birthcert}}" target="_blank">View Document</a>
                      <input type="text" name="birthcerttext" value="{{registration.birthcert}}" hidden>
                      {{#if user.ptaverified}}<button type="button" class="clear-input"
                        onclick="clearInput(this)">x</button>{{/if}}
                    {{else}}
                      No File
                      {{#unless user.ptaverified}}<input type="file" name="birthcert" required> {{/unless}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <td colspan="2"><strong>Proof of Education:</strong></td>
                  <td class="information">
                    {{#if registration.educproof}}
                      <a href="{{registration.educproof}}" target="_blank">View Education Proof</a>
                      <input type="text" name="educprooftext" value="{{registration.educproof}}" hidden>
                      {{#if user.ptaverified}}<button type="button" class="clear-input"
                        onclick="clearInput(this)">x</button>{{/if}}
                    {{else}}
                      No File
                      {{#unless user.ptaverified}}<input type="file" name="educproof" required> {{/unless}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <td colspan="2"><strong>Poomsae Certificate:</strong></td>
                  <td class="information">
                    {{#if registration.educproof}}
                      <a href="{{registration.educproof}}" target="_blank">View Poomsae Certificate</a>
                      <input type="text" name="educprooftext" value="{{registration.educproof}}" hidden>
                      {{#if user.ptaverified}}<button type="button" class="clear-input"
                        onclick="clearInput(this)">x</button>{{/if}}
                    {{else}}
                    No File
                      {{#unless user.ptaverified}}<input type="file" name="educproof" required> {{/unless}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <td colspan="2"><strong>Kukkiwon Certificate:</strong></td>
                  <td class="information">
                    {{#if registration.kukkiwoncert}}
                      <a href="{{registration.kukkiwoncert}}" target="_blank">View Kukkiwon Certificate</a>
                      <input type="text" name="kukkiwoncerttext" value="{{registration.kukkiwoncert}}" hidden>
                      {{#if user.ptaverified}}<button type="button" class="clear-input"
                        onclick="clearInput(this)">x</button>{{/if}}
                    {{else}}
                    No File
                      {{#unless user.ptaverified}}<input type="file" name="kukkiwoncert" required> {{/unless}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  <td colspan="2"><strong>PTA Black-Belt Certificate:</strong></td>
                  <td class="information">
                    {{#if registration.ptablackbeltcert}}
                      <a href="{{registration.ptablackbeltcert}}" target="_blank">View Black-Belt Certificate</a>
                      <input type="text" name="ptablackbeltcerttext" value="{{registration.ptablackbeltcert}}" hidden>
                      {{#if user.ptaverified}}<button type="button" class="clear-input"
                        onclick="clearInput(this)">x</button>{{/if}}
                    {{else}}
                    No File
                      {{#unless user.ptaverified}}<input type="file" name="ptablackbeltcert" required> {{/unless}}
                    {{/if}}
                  </td>
                </tr>
                <tr>
                  
                 
                  <td colspan="2"><strong>Proof of Payment:</strong>
                  <button class="showqrbtn" type="button" onclick="togglePicture(this, '{{registration.paymentproof}}')">QR</button></td>
                  <td class="information">
                    {{#if registration.paymentproof}}
                      <a href="{{registration.paymentproof}}" target="_blank">View Payment Proof</a>
                      <input type="text" name="paymentprooftext" value="{{registration.paymentproof}}" hidden>
                      {{#if user.ptaverified}}<button type="button" class="clear-input"
                        onclick="clearInput(this)">x</button>{{/if}}
                    {{else}}
                    No File
                      {{#unless user.ptaverified}}<input type="file" name="paymentproof" required> {{/unless}}
                    {{/if}}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
        {{#if user.ptaverified}}
         <button type="button" class="confirm-reject-btn" onclick="openConfirmRejectionScreen()">Confirm rejections</button>
        {{else}}
          {{#if (eq registration.status 5)}}
            <button type="submit" class="submit-changes-btn">Renew Membership</button>
          {{else}}
            <button type="submit" class="submit-changes-btn">Submit Changes</button>
          {{/if}}
        {{/if}}
    </section>

      <input type="hidden" name="applicationId" value="{{registration.id}}">
      <section class="application-actions">
        <h1 class="status">
          <h2>Shipping Status:</h2>
          {{#if (eq registration.status 1)}}
            <span class="status-under-review">Under Review</span>
          {{else if (eq registration.status 2)}}
            <span class="status-en-route">En-route to Regional Office</span>
          {{else if (eq registration.status 3)}}
            <span class="status-shipped">ID Shipped</span>
          {{else if (eq registration.status 4)}}
            <span class="status-rejected">Rejected</span><br>
            Reason:<p class="suspendmsg">{{registration.rejectmsg}}</p>
            Description:<p class="description">{{registration.rejectdescription}}</p>
          {{else if (eq registration.status 5)}}
            <span class="status-unknown">Expired</span>
          {{else if (eq registration.status 6)}}
            <span class="status-unknown">Suspended</span><br>
            Reason:<p class="suspendmsg">{{registration.suspendmsg}}</p>
            Description:<p class="description">{{registration.susdescription}}</p>
          {{/if}}

          <h2>Activation Status:</h2>
          {{#if thisinstructor.instructorverified}}
            <span class="status-activated" style="color: rgb(0, 212, 0);"><strong>Active</strong></span>
          {{else}}
            <span class="status-disabled" style="color: rgb(252, 42, 42);"><strong>Inactive</strong></span>
          {{/if}}
        </h1>
        
        {{#if user.ptaverified}}
          <div class="action-buttons">
            <button type="button" onclick="printDiv('printableArea')">Print</button>
            <button type="submit" name="status" value="1">Under Review</button>
            <button type="submit" name="status" value="2">En-route to Regional Office</button>
            {{#unless (eq registration.status 3)}}
              <button type="button" id="idshipped" class="idshipped">ID Shipped</button>
            {{/unless}}
            {{!-- {{#if (eq registration.status 3)}} --}}
            {{#if thisinstructor.instructorverified}}
              <button type="button" id="suspendbtn" class="suspendbtn">Suspend this Instructor</button>
            {{else}}
              <button type="button" id="rejectbtn" class="rejectbtn">Reject Application</button>
            {{/if}}
          </div>

          <div class="confirmrejectscreen" id="confirmrejectscreen" style="display: none;">
            <h3>Please state reason for rejection.</h3>
            <select name="rejectmsg" id="rejectmsg">
              <option value="Incomplete Documentation">Incomplete Documentation</option>
              <option value="Invalid Information">Invalid Information</option>
              <option value="Failed Background Check">Failed Background Check</option>
              <option value="Other">Other</option>
            </select>
            <textarea name="rejectdescription" id="rejectdescription" cols="30" rows="10"></textarea>
            <button type="button" class="cancelreject" id="cancelreject">Cancel</button>
            <button type="submit" value="4" name="status" id="confirm">Confirm</button>
          </div>

          <div class="confirmsuspendscreen" id="confirmsuspendscreen" style="display: none;">
            <h3>This action will suspend the instructor's license, not allowing him to register any more clubs. Please
              state reason for suspension.</h3>
            <select name="suspendmsg" id="suspendmsg">
              <option value="Expired">Expired</option>
              <option value="Invalid Information">Invalid Information</option>
              <option value="Failed Background Check">Failed Background Check</option>
              <option value="Other">Other</option>
            </select>
            <textarea name="susdescription" id="susdescription" cols="30" rows="10"></textarea>
            <button type="button" class="cancelsuspend" id="cancelsuspend">Cancel</button>
            <button type="submit" value="6" name="status" id="confirm">Confirm</button>
          </div>

          <div class="confirmscreen" id="confirmscreen" style="display: none;">
            <h3>Are you sure? The applicant will be notified that his ID is ready for pickup.</h3>
            <button type="button" class="cancel" id="cancel">Cancel</button>
            <button type="submit" value="3" name="status" id="confirm">Confirm</button>
          </div>
        {{/if}}
        

      {{!-- </section> --}}

      <div class="printwindow" id="printableArea">
        <div class="id-card">
          <div class="id-front">
            <div class="card-header">NATIONAL COMPETITORS CARD</div>
            <div class="pta-header">
              <div class="pta-text">PTA 2024</div>
            </div>
            <div class="photo-area">
              {{#if registration.portrait}}
              <img src="{{registration.portrait}}" alt="Instructor Photo" class="athlete-photo">
              {{else}}
              <img src="/images/none.jpg" alt="Instructor Photo" class="athlete-photo">
              {{/if}}
            </div>
            <div class="card-details">
              <div class="athlete-name">{{registration.firstname}} {{registration.middlename}} {{registration.lastname}}</div>
              <div class="athlete-id">ID: {{registration.id}}</div>
              <div class="membership-type">MEMBERSHIP TYPE: INSTRUCTOR</div>
              <div class="chapter">CHAPTER: {{registration.clubprovince}}</div>
              <div class="birthdate">BIRTHDATE: {{formatDate registration.bday "MMMM D, YYYY"}}</div>
            </div>
          </div>
        </div>
      </div>

      <div class="confirmscreen" id="confirmscreen" style="display: none;">
        <h3>Are you sure? The player will be notified that his ID is ready. This registration will also disappear after
          a few days.</h3>
        <button type="button" class="cancel" id="cancel">Cancel</button>
        <button type="submit" value="4" name="status" id="confirm">Confirm</button>
      </div>
    </form>
    
    <div class="action-buttons">
      <form action="/activate-instructor-membership" method="post">
        <input type="text" name="applicationId" value="{{registration.id}}" hidden>
        <input type="text" name="submittedby" value="{{registration.submittedby}}" hidden>
        {{#unless thisinstructor.instructorverified}}
          <button type="submit" id="activatebtn" class="activatebtn" onclick="return confirm('Are you sure you want to activate this membership?')">Activate Membership</button>
        {{/unless}}
      </form>
    </div>
    <div class="backtolist">
      <a href="/membership-status">Back to list</a>
    </div>
  </section>
  </main>

  {{> footer}}

  <script src="/scripts/navbar.js"></script>
  <script src="/scripts/footer.js"></script>
  <script>
    const confirmscreen = document.getElementById("confirmscreen");
    const confirmrejectscreen = document.getElementById("confirmrejectscreen");
    const cancelreject = document.getElementById("cancelreject");
    const actionButtons = document.querySelector(".action-buttons");
    const cancel = document.getElementById("cancel");
    const idshipped = document.getElementById("idshipped");
    const rejectbtn = document.getElementById("rejectbtn");

    document.addEventListener("DOMContentLoaded", function () {
      const suspendbtn = document.getElementById("suspendbtn");
      const confirmsuspendscreen = document.getElementById("confirmsuspendscreen");
      const cancelsuspend = document.getElementById("cancelsuspend");

      cancelsuspend.addEventListener("click", function (event) {
        event.preventDefault();
        confirmsuspendscreen.style.display = "none";
        actionButtons.style.display = "block";
      });

      suspendbtn.addEventListener("click", function (event) {
        event.preventDefault();
        confirmsuspendscreen.style.display = "block";
        actionButtons.style.display = "none";
      });
    });

    function openConfirmRejectionScreen() {
      confirmrejectscreen.style.display = "block";
      actionButtons.style.display = "none";
    }

    function clearInput(button) {
      const input = button.previousElementSibling;
      if (input.value === '') {
        input.value = input.getAttribute('data-original-value');
        button.textContent = 'x';
      } else {
        input.setAttribute('data-original-value', input.value);
        input.value = '';
        button.textContent = 'undo';
      }
    }

    cancel.addEventListener("click", function (event) {
      event.preventDefault();
      confirmscreen.style.display = "none";
      actionButtons.style.display = "block";
    });

    idshipped.addEventListener("click", function (event) {
      event.preventDefault();
      confirmscreen.style.display = "block";
      actionButtons.style.display = "none";
    });

    cancelreject.addEventListener("click", function (event) {
      event.preventDefault();
      confirmrejectscreen.style.display = "none";
      actionButtons.style.display = "block";
    });

    rejectbtn.addEventListener("click", function (event) {
      event.preventDefault();
      confirmrejectscreen.style.display = "block";
      actionButtons.style.display = "none";
    });

    function printDiv(divName) {
      // Prevent any form submission
      event.preventDefault();
      
      const printContents = document.getElementById(divName);
      const originalDisplay = printContents.style.display;
      
      // Add print-specific styles
      const style = document.createElement('style');
      style.innerHTML = `
        @media print {
          body * {
            visibility: hidden;
          }
          #${divName}, #${divName} * {
            visibility: visible;
          }
          #${divName} {
            position: absolute;
            left: 0;
            top: 0;
          }
        }
      `;
      document.head.appendChild(style);
      
      // Show the printable area
      printContents.style.display = 'block';
      
      // Print with afterprint handler
      window.onafterprint = () => {
        // Cleanup after printing
        printContents.style.display = originalDisplay;
        document.head.removeChild(style);
        window.onafterprint = null;
      };
      
      window.print();
    }

    function toggleDropdown() {
      document.getElementById("dropdown").classList.toggle("show");
    }

    function togglePicture(button, imageUrl) {
      const img = document.createElement('img');
        img.src = '../images/uselss qr.png';
      img.style.maxWidth = '100%';
      img.style.maxHeight = '100%';
      img.style.display = 'block';
      img.style.margin = '0 auto';

      const modal = document.createElement('div');
      modal.style.position = 'fixed';
      modal.style.top = '0';
      modal.style.left = '0';
      modal.style.width = '100%';
      modal.style.height = '100%';
      modal.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
      modal.style.display = 'flex';
      modal.style.justifyContent = 'center';
      modal.style.alignItems = 'center';
      modal.style.zIndex = '1000';

      modal.appendChild(img);

      modal.addEventListener('click', () => {
        document.body.removeChild(modal);
      });

      document.body.appendChild(modal);
    }
  </script>

  <style>
    /* ID card styles */
    .id-card {
      width: 2.5in;
      height: 4in;
      background: linear-gradient(150deg, #003366 70%, #cc0000 70%);
      border-radius: 10px;
      position: relative;
      color: white;
      font-family: Arial, sans-serif;
      overflow: hidden;
      padding: 0;
      margin: 0 auto;
    }
    
    .id-front {
      position: relative;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      padding: 10px;
    }
    
    .card-header {
      font-size: 12px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 5px;
      position: absolute;
      top: 10px;
      width: 100%;
      left: 0;
      text-transform: uppercase;
      color: white;
    }
    
    .pta-header {
      position: absolute;
      top: 30px;
      left: 0;
      z-index: 2;
      text-align: center;
      width: 100%;
    }
    
    .pta-text {
      font-size: 20px;
      font-weight: bold;
      color: rgba(255, 255, 255, 0.8);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
      letter-spacing: 1px;
    }
    
    .photo-area {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: 1.5in;
      height: 1.5in;
      background: white;
      border: 2px solid white;
      overflow: hidden;
    }
    
    .athlete-photo {
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 1;
    }
    
    .card-details {
      position: absolute;
      bottom: 15px;
      left: 15px;
      width: calc(100% - 30px);
      z-index: 2;
      text-align: left;
    }
    
    .athlete-name {
      font-size: 16px;
      font-weight: bold;
      margin-bottom: 5px;
      text-transform: uppercase;
      text-align: left;
    }
    
    .athlete-id,
    .chapter,
    .birthdate {
      font-size: 12px;
      margin-bottom: 3px;
      text-transform: uppercase;
      text-align: left;
    }

    .membership-type {
      font-size: 12px;
      margin: 5px 0;
      text-transform: uppercase;
      color: #ffeb3b;
      font-weight: bold;
      text-align: left;
    }
    
    .athlete-id {
      margin-bottom: 8px;
    }
    
    @media print {
      @page {
        size: 2.5in 4in;
        margin: 0;
      }
    
      body * {
        visibility: hidden;
      }
    
      #printableArea,
      #printableArea * {
        visibility: visible;
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }
    
      #printableArea {
        position: absolute;
        left: 0;
        top: 0;
        width: 2.5in;
        height: 4in;
      }
    
      .id-card {
        background: linear-gradient(150deg, #003366 70%, #cc0000 70%) !important;
        margin: 0;
        padding: 0;
      }
    
      .photo-area {
        margin: 0;
        border: none;
      }
    }
  </style>
</body>

</html>